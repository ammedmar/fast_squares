
\section{New formulas} \label{s:new formulas}

Let $X$ be a simplicial complex and $x \in X_n$. For a set
\begin{equation*}
U = \{u_1 < \dots < u_r\} \subseteq \{0, \dots, n\}
\end{equation*}
we use the notation $d_U(x) = d_{u_1} \ldots\, d_{u_r}(x)$.

\begin{definition} \label{d:cup-i coproducts}	
	For a non-negative integer $i$, the \textit{cup-$i$ coproduct}
	\begin{equation*}
	\Delta_i : C_\bullet(X; \F) \to C(X; \F)^{\otimes 2}_\bullet
	\end{equation*}
	is the linear map defined on a basis element $x \in X_n$ by
	\begin{equation} \label{equation: simplicial cup-i coproducts}
	\Delta_i(x) = \sum_U d_{U^+}(x) \tensor d_{U^-}(x),
	\end{equation}
	where the sum is taken over all sets $U = \{u_1 < \cdots < u_{n-i}\}$ with $u_j \in \{0, \dots, n\}$ and
	\begin{equation*}
	U^+ = \{u_j \in U\ |\ u_j \equiv j \text{ mod } 2\}, \qquad
	U^- = \{u_j \in U\ |\ u_j \not\equiv j \text{ mod } 2\}.
	\end{equation*}
	For a negative integer $i$ we set $\Delta_i = 0$.
\end{definition}

\begin{lemma}
	This construction is natural with respect to simplicial maps.
	Explicitly, if $f$ is a simplicial map, then, for every $i \in \Z$,
	\begin{equation*}
	\Delta_i \circ f_\bullet = (f_\bullet \otimes f_\bullet) \circ \Delta_i.
	\end{equation*}
\end{lemma}

\begin{proof}
	content...
\end{proof}

\begin{theorem} \label{t:main}
	For any integer $i$,
	\begin{equation} \label{eq: cup-i coproducts boundary relation}
	\partial \circ \Delta_{i} + \Delta_{i+1} \circ \partial = (1 +T ) \Delta_{i-1}.
	\end{equation}
\end{theorem}

We devote Section~\ref{s:proof} to the proof of this theorem.

\begin{example}
	AW diagonal and $Sq^0$.
\end{example}

\section{New algorithm}

Given a finite simplicial complex $X$ we now present an algorithm for the determination of a cocycle representative of $Sq^k([\alpha])$ given a representative cocycle $\alpha$ in degree $-n$.

If $k$ is a negative integer or greater than $n$ we $Sq^k([\alpha]) = 0$, and if $k = 0$ we we have $Sq^k([\alpha]) = [\alpha]$ which are uninteresting cases, so we assume $k$ is between $1$ and $n$.

Consider $A = \{a_1, \dots, a_m\} \subseteq X_n$ with $\alpha = \alpha_1 + \cdots + \alpha_m$ such that
\begin{equation*}
\alpha_i(a_j) = \begin{cases}
1 & i=j, \\ 0 & i\neq j,
\end{cases}
\end{equation*}
and let $B \subseteq X_{n+k}$ the output of the algorithm presented in Figure~\ref{f:algorithm} applied to $A$.
We will prove the correctness of this algorithm by showing that $B$ corresponds to the cocycle $\beta = (\alpha \otimes \alpha)\Delta_{n-k}(-)$.

\begin{lemma} \label{l:freeness}
	For any $x \in X_{n+k}$ and $i,j \in \{1,\dots,m\}$ we have:
	\begin{itemize}
		\item if $i=j$, then $(\alpha_i \otimes \alpha_j)\Delta_{n-k}(x) = 0$,
		\item if $i \neq j$ and $(\alpha_i \otimes \alpha_j)\Delta_{n-k}(x) \neq 0$, then $(\alpha_j \otimes \alpha_i)\Delta_{n-k}(x) = 0$.
	\end{itemize}
\end{lemma}

\begin{proof}
	Let $U, V \subseteq \{0, \dots, n\}$ be any pair of subsets. If at least one of them is not empty, then $U^+ \neq V^-$.
\end{proof}

For any $x \in X_{n+k}$ the value of $\beta$ evaluated on the chain represented by $x$ is given by 
\begin{align*}
\beta(x) & =
(\alpha \otimes \alpha) \Delta_{n-k}(x) \\ & =
(\alpha_1 + \cdots + \alpha_m)^{\otimes 2} \Delta_{n-k}(x) \\ & =
\Big(\sum_{i \neq j} \alpha_i \otimes \alpha_j + \sum_{i} \alpha_i \otimes \alpha_i \Big)
\Delta_{n-k}(x) \\ & =
\Big(\sum_{i \neq j} \alpha_i \otimes \alpha_j\Big)
\Delta_{n-k}(x).
\end{align*}
By Lemma~\ref{l:freeness}, only one of the terms $\alpha_i \otimes \alpha_j$ and $\alpha_j \otimes \alpha_i$ evaluates to $1$ on $\Delta_{n-k}(x)$, so to determine the value of $\beta(x)$ we need to count mod-2 the number of two element subsets $\{i,j\} \subseteq \{1,\dots, m\}$ such that $\{a_i, a_j\} = \{d_{U^+}(x), d_{U^-}(x)\}$ for some $U \subseteq \{0, \dots, n\}$ of cardinality $k$.
This condition on the pair $\{a_i, a_j\}$ implies in particular, since for any such $U$ the union of the vertices of $d_{U^+}(x)$ and $d_{U^-}(x)$ is $x$, that $a_i \cup a_j = x$.

Let us formalize these observations.
Let $\widetilde{A}$ be the set of all two element sets $\{a_i, a_j\} \subseteq A$ such that $a_i \cup a_j \in X_{n+k}$.
There is a natural map $\pi \colon \widetilde{A} \to X_{n+k}$ sending $\{a_i, a_j\}$ to $a_i \cup a_j$.
Let $\eval \colon A \to \F_2$ be the map sending $\{a_i, a_j\}$ to $1$ if there exist $U \subseteq \{0,\dots,n\}$ of cardinality $k$ such that $\{a_i, a_j\} = \{d_{U^+}(x), d_{U^-}(x)\}$, notice that if such $U$ exists then it is unique, and to $0$ otherwise.
With this notation we have
\begin{equation*}
\beta(x) = \sum_{\pi^{-1}(x)} \eval(\{a_i, a_j\}).
\end{equation*}
We now give necessary and sufficient conditions for $\eval(\{a_i, a_j\}) = 1$.


\begin{figure}
	\input{stsq}
	\caption{Algorithm producing for a simplicial complex $X$, non-negative integer $n$, integer $k$ between $1$ and $n$, and cocycle $\alpha$, presented as a set $A \subseteq X_n$, a cocycle representing $Sq^k([\alpha])$ identified with a set $B \subseteq X_{n+k}$.
	We use the notation $S \xor S^\prime = S \cup S^\prime \setminus (S \cap S^\prime)$.}
	\label{f:algorithm}
\end{figure}